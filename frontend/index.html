<!DOCTYPE html>
<html>
<head>
    <title>GrocerX</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<!-- Animated grocery background -->
<div class="bg-pattern">
    <span>ğŸ</span><span>ğŸ¥•</span><span>ğŸ¥¦</span><span>ğŸ</span><span>ğŸ¥›</span>
    <span>ğŸŒ</span><span>ğŸ…</span><span>ğŸ¥¬</span><span>ğŸ§€</span><span>ğŸ‰</span>
    <span>ğŸ</span><span>ğŸ¥•</span><span>ğŸ¥¦</span><span>ğŸ</span><span>ğŸ¥›</span>
    <span>ğŸŒ</span><span>ğŸ…</span><span>ğŸ¥¬</span><span>ğŸ§€</span><span>ğŸ‰</span>
    <span>ğŸ</span><span>ğŸ¥•</span><span>ğŸ¥¦</span><span>ğŸ</span><span>ğŸ¥›</span>
    <span>ğŸŒ</span><span>ğŸ…</span><span>ğŸ¥¬</span><span>ğŸ§€</span><span>ğŸ‰</span>
</div>

<div class="app">

    <header>
        <h1>ğŸ¥¬ GrocerX</h1>
        <p>Smart Grocery Management System</p>
    </header>

    <!-- Add Grocery -->
    <div class="card">
        <h2>Add Grocery</h2>

        <input type="text" id="itemName" placeholder="Item name">

        <div class="qty-row">
            <!-- âœ… CHANGED: min="1" -->
            <input type="number" id="quantity" placeholder="Quantity" min="1">
            <select id="quantityUnit">
                <option value="kg">âš–ï¸ kg</option>
                <option value="items">ğŸ”¢ items</option>
            </select>
        </div>

        <input type="date" id="expiryDate">
        <button onclick="addItem()">Add Item</button>
    </div>

    <!-- Added Items -->
    <div class="card">
        <h2>Added Items</h2>
        <ul id="itemList"></ul>
    </div>

    <!-- Expiry Alerts -->
    <div class="card alert-card">
        <h2>Expiry Alerts</h2>
        <ul id="expiryAlert">
            <li>No items expiring soon</li>
        </ul>
    </div>

    <!-- Shopping List -->
    <div class="card">
        <h2>Shopping List</h2>
        <ul id="shoppingList">
            <li>No items to buy yet</li>
        </ul>
    </div>

</div>

<script>
    let items = [];

    function formatDate(date) {
        const day = String(date.getDate()).padStart(2, '0');
        const month = date.toLocaleString('en-US', { month: 'short' });
        const year = date.getFullYear();
        const weekday = date.toLocaleString('en-US', { weekday: 'short' });
        return `${day} ${month} ${year} (${weekday})`;
    }

    function addItem() {
        const name = document.getElementById("itemName").value.trim();
        const quantity = parseFloat(document.getElementById("quantity").value);
        const unit = document.getElementById("quantityUnit").value;
        const expiryValue = document.getElementById("expiryDate").value;

        /* âœ… VALIDATION: quantity must be >= 1 */
        if (!name || isNaN(quantity) || quantity < 1) {
            alert("Quantity must be 1 or more");
            return;
        }

        if (unit === "items" && !expiryValue) {
            alert("Expiry date required for packaged items");
            return;
        }

        let expiryDate;
        if (unit === "kg" && !expiryValue) {
            expiryDate = new Date();
            expiryDate.setDate(expiryDate.getDate() + 7);
        } else {
            expiryDate = new Date(expiryValue);
        }

        items.push({ name, quantity, unit, expiryDate });
        updateAll();

        document.getElementById("itemName").value = "";
        document.getElementById("quantity").value = "";
        document.getElementById("expiryDate").value = "";
    }

    function updateAll() {
        updateExpiryAlerts();
        updateShoppingList();
        updateItems();
    }

    function updateExpiryAlerts() {
        const ul = document.getElementById("expiryAlert");
        ul.innerHTML = "";
        const today = new Date();
        let found = false;

        items.forEach(item => {
            const daysLeft = Math.ceil((item.expiryDate - today) / 86400000);
            if (daysLeft <= 30) {
                found = true;
                const li = document.createElement("li");
                li.textContent = `${item.name} expires in ${daysLeft} days`;
                ul.appendChild(li);
            }
        });

        if (!found) {
            ul.innerHTML = "<li>No items expiring soon</li>";
        }
    }

    function updateShoppingList() {
        const ul = document.getElementById("shoppingList");
        ul.innerHTML = "";
        const today = new Date();
        let found = false;

        items.forEach(item => {
            const daysLeft = Math.ceil((item.expiryDate - today) / 86400000);
            if (daysLeft <= 30) {
                found = true;
                const li = document.createElement("li");
                li.textContent = `${item.name} (use / buy soon)`;
                ul.appendChild(li);
            }
        });

        if (!found) {
            ul.innerHTML = "<li>No items to buy yet</li>";
        }
    }

    function updateItems() {
        const ul = document.getElementById("itemList");
        ul.innerHTML = "";

        items.forEach(item => {
            const li = document.createElement("li");
            li.innerHTML = `
                <strong>${item.name}</strong>
                <span>Qty: ${item.quantity} ${item.unit}</span>
                <span>Expiry: ${formatDate(item.expiryDate)}</span>
            `;
            ul.appendChild(li);
        });
    }

    setInterval(updateAll, 10000);
</script>

</body>
</html>
